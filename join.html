<!DOCTYPE HTML>

<head>
    <title>AnyAsk 익명을 향한 당신의 질문</title>
    <meta charset="utf-8">
    <!--include css-->
    <link href="stylesheets/style.css" rel="stylesheet" type="text/css">

    <!--include jquery-->
    <script src="javascripts/jquery/jquery_min.js"></script>

    <!--include dynamic function javascript-->
    <script src="javascripts/AskJs.js" type="text/javascript"></script>
    <script src="javascripts/menulist.js" type="text/javascript"></script>

    <!--connect firebase-->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-analytics.js"></script>

    <script src="javascripts/firebase/connect_firebase.js" type="text/javascript"></script>
</head>

<body>
    <section id="maintop">
        <div class="top-area">
            <div class="logo">
                <h1><a href="index.html">AnyAsk</a></h1>
            </div>

            <div class="login-form">
                <ul id="login-list">
                </ul>
            </div>
        </div>
    </section>
    <div class="wrapper">
        <section id="mainmiddle">
            <form id="join">
                <table style="margin:0 auto;">
                    <tr>
                        <td><input class="input_style" type="text" name="id" id="id" placeholder="아이디" required></td>
                        <td><input type="button" onclick="IdOverlabCheck()" value="중복검사"></td>
                    </tr>
                    <tr>
                        <td><input class="input_style" type="password" name="pw" id="pw" placeholder="비밀번호" required>
                        </td>
                    </tr>
                    <tr>
                        <td><input class="input_style" type="text" name="username" id="username" placeholder="이름"
                                required></td>
                    </tr>
                    <tr>
                        <td><input class="input_style" type="text" name="email" id="email" placeholder="이메일" required>
                        </td>
                    </tr>
                    <tr>
                        <td><input class="join_go" type="button" value="회원가입" onclick="savaUserInfo()" /></td>
                    </tr>
                </table>
            </form>
        </section>
    </div>
</body>
<footer>
</footer>

</html>

<script>
    let join_count = 0;

    function IdOverlabCheck() {
        let id = document.getElementById("id").value;
        console.log(id);
        for (var i = 0; i <= user_id_list.length - 1; i++) {
            if (id == "") {
                alert("아이디를 입력해주세요.");
                break;
            }

            else if (id == user_id_list[i]) {
                alert("중복된 아이디가 있습니다.");
                break;
            }
            else {
                alert("사용 가능한 아이디 입니다.");
                join_count++;
                break;
            }
        }
    }
    function savaUserInfo() {

        let id = document.getElementById("id").value;
        let pw = document.getElementById("pw").value;
        let name = document.getElementById("username").value;
        let email = document.getElementById("email").value;

        if (join_count >= 1) {
            var userTable = database.ref("users/" + id + "/");

            var userInfo = {
                "userinfo": {
                    userId: id,
                    userPw: pw,
                    userName: name,
                    userEmail: email
                }

            }
            userTable.update(userInfo); //회원정보가 초기 베이스이므로 set함수를 써준다.

            alert("가입완료~!");

            window.location.href = "index.html";
            join_count = 0;
        }
        else {
            alert("아이디 중복검사를 실행해주세요.");
        }

    }

    /*
    var dbRef = database.ref('users/');
    dbRef.on('child_added', function (data) {
        firebase.database().ref('/users/fff/userinfo/').orderByKey().once('value').then(function (snapshot) {
            var rows = [];
            snapshot.forEach(function (userSnapshot) {
                var userVal = userSnapshot.val();
                rows.push(userVal);
            });
            for (var i = 0; i <= rows.length - 1; i++) {
                console.log(rows[i]);
            }
        });
    });
    var test = sessionStorage.getItem("key");
    console.log(test);
    */
</script>